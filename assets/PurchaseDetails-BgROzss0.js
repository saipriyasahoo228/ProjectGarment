import{aa as te,ab as ae,j as e,r as s,J as ye,K as y,M as J,O as X,Q as K,T as l,a6 as ve,a7 as be,a8 as Ce,a9 as U,W as De,U as i,V as Y,X as Re,S as Ie,Y as Pe,Z as Se,_ as Z,$ as r,a1 as qe,a0 as ee,G as f}from"./index-v_C5IRK2.js";import{A as Ee}from"./Alert-DWMbTLrd.js";var B={},Te=ae;Object.defineProperty(B,"__esModule",{value:!0});var re=B.default=void 0,Ae=Te(te()),We=e;re=B.default=(0,Ae.default)((0,We.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete");var L={},ke=ae;Object.defineProperty(L,"__esModule",{value:!0});var ne=L.default=void 0,Ve=ke(te()),we=e;ne=L.default=(0,Ve.default)((0,we.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit");function Le(){const[p,v]=s.useState({party_name:"",address:"",item:""}),[M,se]=s.useState([]),[N,O]=s.useState(!1),[b,q]=s.useState({voucher_number:"",voucher_date:""}),[x,j]=s.useState([]),[u,E]=s.useState({quantity:"",rate:"",discount_percentage:"",gst_percentage:"",discount_amount:0,taxable_amount:0,gst_amount:0,purchase_amount:0}),[oe,T]=s.useState(!1),[$,d]=s.useState(""),[_,A]=s.useState(null),[le,C]=s.useState(!1),[W,k]=s.useState(null),ce=s.useRef(null),ie=s.useRef(null),ue=s.useRef(null),de=s.useRef(null),he=s.useRef(null),me=s.useRef(null);s.useEffect(()=>{const t=async()=>{try{const n=await f.get("api/purchase/purchase-entry/");j(n.data.data)}catch(n){console.error("Error fetching data:",n)}};(async()=>{O(!0);try{const n=await f.get("/api/user/party/");se(n.data.data)}catch{d("Failed to load parties")}finally{O(!1)}})(),t()},[]);const V=t=>{const{name:a,value:n}=t.target;if(a==="party_name"){const c=M.find(g=>g.party_name===n);c&&v({...p,party_name:c.party_name,address:c.address,item:c.item||""})}else v({...p,[a]:n})},z=t=>{const{name:a,value:n}=t.target;q({...b,[a]:n})},D=t=>{const{name:a,value:n}=t.target,c={...u,[a]:n},g=parseFloat(c.quantity)||0,w=parseFloat(c.rate)||0,R=g*w,F=parseFloat(c.discount_percentage)/100*R,I=R-F,h=parseFloat(c.gst_percentage)/100*I,o=I+h;E({...c,discount_amount:F||0,taxable_amount:I||0,gst_amount:h||0,purchase_amount:o||0})},pe=async()=>{d("");const{party_name:t,address:a,item:n}=p,{voucher_number:c,voucher_date:g}=b,{quantity:w,rate:R,discount_percentage:F,gst_percentage:I}=u;if(!t||!a||!c||!g||!w||!R||!n){alert("Please fill in all fields."),d("Please fill in all fields.");return}const h={...u,party_name:t,address:a,item:n,voucher_number:c,voucher_date:g};console.log("Saving Item:",JSON.stringify(h,null,2));try{let o;_!==null?o=await f.put(`api/purchase/purchase-entries/${h.party_name}/`,h):o=await f.post("api/purchase/purchase-entry/",h);const m=o.data;if(_!==null){const P=x.map((S,_e)=>_e===_?m:S);j(P),A(null)}else j([...x,m]);xe(),ge(),alert("✅ Item saved successfully!")}catch(o){console.error("Error saving data:",o);let m="Error saving data. Please try again.";if(o.response&&o.response.data)if(console.log("Error response data:",o.response.data),o.response.data.error){const P=o.response.data.error;m=Object.keys(P).map(S=>`${S}: ${P[S].join(", ")}`).join(`
`)}else o.response.data.detail&&(m=o.response.data.detail);alert("⚠️ "+m),d(m)}},xe=async()=>{try{const t=await f.get("api/purchase/purchase-entry/");j(t.data.data)}catch(t){console.error("Error fetching data:",t)}},ge=()=>{v({party_name:"",address:"",item:""}),q({voucher_number:"",voucher_date:""}),E({quantity:"",rate:"",discount_percentage:"",gst_percentage:"",discount_amount:0,taxable_amount:0,gst_amount:0,purchase_amount:0}),T(!1),d("")},G=(t=null)=>{if(t!==null){const a=x[t];E({quantity:a.quantity,rate:a.rate,discount_percentage:a.discount_percentage,gst_percentage:a.gst_percentage,discount_amount:a.discount_amount,taxable_amount:a.taxable_amount,gst_amount:a.gst_amount,purchase_amount:a.purchase_amount}),v({party_name:a.party_name,address:a.address,item:a.item}),q({voucher_number:a.voucher_number,voucher_date:a.voucher_date}),A(t)}else A(null);T(!0)},H=()=>{T(!1),d("")},fe=t=>{k(t),C(!0)},Q=()=>{C(!1),k(null)},je=async()=>{if(W!==null){const t=x[W];try{await f.delete(`api/purchase/purchase-entries/${t.party_name}/`),j(x.filter((a,n)=>n!==W)),k(null),C(!1)}catch(a){console.error("Error deleting item:",a),d("Failed to delete the item. Please try again."),C(!1)}}};return e.jsxs(ye,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(y,{variant:"contained",color:"secondary",onClick:()=>G(),children:_!==null?"Edit Purchase":"Add Purchase"}),e.jsxs(J,{open:oe,onClose:H,maxWidth:"md",fullWidth:!0,children:[e.jsx(X,{style:{backgroundColor:"#f9dff5"},children:_!==null?"Edit Purchase":"Add Purchase"}),e.jsxs(K,{style:{backgroundColor:"#f9dff5"},children:[$&&e.jsx(Ee,{severity:"error",children:$}),e.jsxs(l,{container:!0,spacing:2,marginBottom:2,children:[e.jsx(l,{item:!0,xs:6,children:e.jsxs(ve,{fullWidth:!0,margin:"normal",children:[e.jsx(be,{children:"Party Name"}),e.jsx(Ce,{value:p.party_name,onChange:V,label:"Party Name",name:"party_name",required:!0,disabled:N,inputRef:ce,children:N?e.jsx(U,{disabled:!0,children:e.jsx(De,{size:24})}):M.map(t=>e.jsx(U,{value:t.party_name,children:t.party_name},t.id))})]})}),e.jsx(l,{item:!0,xs:6,children:e.jsx(i,{fullWidth:!0,label:"Address",name:"address",value:p.address,onChange:V,required:!0,margin:"normal",inputRef:ie})})]}),e.jsxs(l,{container:!0,spacing:2,marginBottom:2,children:[e.jsx(l,{item:!0,xs:6,children:e.jsx(i,{fullWidth:!0,label:"Item",name:"item",value:p.item,onChange:V,required:!0,margin:"normal",inputRef:ue})}),e.jsx(l,{item:!0,xs:6,children:e.jsx(i,{fullWidth:!0,label:"Voucher Number",name:"voucher_number",value:b.voucher_number,onChange:z,required:!0,margin:"normal",inputRef:de})})]}),e.jsxs(l,{container:!0,spacing:2,marginBottom:2,children:[e.jsx(l,{item:!0,xs:6,children:e.jsx(i,{fullWidth:!0,label:"Voucher Date",type:"date",name:"voucher_date",value:b.voucher_date,onChange:z,required:!0,margin:"normal",InputLabelProps:{shrink:!0},inputRef:he})}),e.jsx(l,{item:!0,xs:6,children:e.jsx(i,{fullWidth:!0,label:"Quantity",name:"quantity",value:u.quantity,onChange:D,required:!0,margin:"normal",inputRef:me})})]}),e.jsxs(l,{container:!0,spacing:2,marginBottom:2,children:[e.jsx(l,{item:!0,xs:6,children:e.jsx(i,{fullWidth:!0,label:"Rate",name:"rate",value:u.rate,onChange:D,required:!0,margin:"normal"})}),e.jsx(l,{item:!0,xs:6,children:e.jsx(i,{fullWidth:!0,label:"Discount (%)",name:"discount_percentage",value:u.discount_percentage,onChange:D,margin:"normal"})})]}),e.jsx(l,{container:!0,spacing:2,marginBottom:2,children:e.jsx(l,{item:!0,xs:6,children:e.jsx(i,{fullWidth:!0,label:"GST (%)",name:"gst_percentage",value:u.gst_percentage,onChange:D,margin:"normal"})})})]}),e.jsxs(Y,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(y,{onClick:pe,color:"secondary",children:"Save"}),e.jsx(y,{onClick:H,color:"error",children:"Cancel"})]})]}),e.jsxs(J,{open:le,onClose:Q,children:[e.jsx(X,{children:"Confirm Deletion"}),e.jsx(K,{children:"Are you sure you want to delete this item?"}),e.jsxs(Y,{children:[e.jsx(y,{onClick:Q,color:"secondary",children:"Cancel"}),e.jsx(y,{onClick:je,color:"error",children:"Confirm"})]})]}),e.jsx(Re,{component:Ie,sx:{overflowX:"auto",marginTop:3},children:e.jsxs(Pe,{children:[e.jsx(Se,{children:e.jsxs(Z,{children:[e.jsx(r,{children:"Party Name"}),e.jsx(r,{children:"Item"}),e.jsx(r,{children:"Voucher Number"}),e.jsx(r,{children:"Voucher Date"}),e.jsx(r,{children:"Quantity"}),e.jsx(r,{children:"Rate"}),e.jsx(r,{children:"Discount (%)"}),e.jsx(r,{children:"GST (%)"}),e.jsx(r,{children:"Discount Amount"}),e.jsx(r,{children:"Taxable Amount"}),e.jsx(r,{children:"GST Amount"}),e.jsx(r,{children:"Purchase Amount"}),e.jsx(r,{children:"Reference Voucher Number"}),e.jsx(r,{children:"Actions"})]})}),e.jsx(qe,{children:x.map((t,a)=>e.jsxs(Z,{children:[e.jsx(r,{children:t.party_name}),e.jsx(r,{children:t.item}),e.jsx(r,{children:t.voucher_number}),e.jsx(r,{children:t.voucher_date}),e.jsx(r,{children:t.quantity}),e.jsx(r,{children:t.rate}),e.jsx(r,{children:t.discount_percentage}),e.jsx(r,{children:t.gst_percentage}),e.jsx(r,{children:t.discount_amount}),e.jsx(r,{children:t.taxable_amount}),e.jsx(r,{children:t.gst_amount}),e.jsx(r,{children:t.purchase_amount}),e.jsx(r,{children:t.reference_voucher_number}),e.jsxs(r,{children:[e.jsx(ee,{color:"secondary",onClick:()=>G(a),children:e.jsx(ne,{})}),e.jsx(ee,{color:"error",onClick:()=>fe(a),children:e.jsx(re,{})})]})]},a))})]})})]})}export{Le as default};
