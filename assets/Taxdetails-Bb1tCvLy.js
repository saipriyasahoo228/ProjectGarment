import{r,j as e,J as Y,K as x,M as A,O as R,Q as w,S as N,a6 as H,a7 as J,a8 as Q,a9 as T,U as P,V as I,W as X,X as ee,Y as ne,Z as te,_ as L,$ as l,a0 as C,a1 as se,a2 as re,a3 as le,G as p}from"./index-DJEOmVav.js";import{E as oe}from"./jspdf.plugin.autotable-BJ5pxiWk.js";import{D as ie}from"./Download-BK-yiSwi.js";function ue(){const[s,h]=r.useState({tax_name:"",tax_percentage:"",description:""}),[o,y]=r.useState([]),[D,c]=r.useState({add:!1}),[G,u]=r.useState(!1),[d,f]=r.useState(null),[m,O]=r.useState(null),[B,g]=r.useState(!1),W=r.useRef(null),b=r.useRef(null),_=r.useRef(null),S=async()=>{try{c(n=>({...n,fetch:!0}));const a=await p.get("/api/user/taxes/");y(a.data.data)}catch(a){console.error("Error fetching tax list",a)}finally{c(a=>({...a,fetch:!1}))}};r.useEffect(()=>{S()},[]);const j=a=>{h({...s,[a.target.name]:a.target.value})},k=(a,n)=>{var i;a.key==="Enter"&&(a.preventDefault(),(i=n.current)==null||i.focus())},q=()=>{u(!0),f(null)},E=()=>{u(!1)},K=async a=>{a.preventDefault(),c(t=>({...t,add:!0}));const n=[],i=/^[A-Za-z-\s]+$/,M=/^[A-Za-z0-9-\s,]+$/;if(s.tax_name.trim()?i.test(s.tax_name)||n.push("Tax Name can only contain letters, hyphens (-), and spaces."):n.push("Tax Name is required."),s.tax_percentage?(isNaN(s.tax_percentage)||s.tax_percentage<0)&&n.push("Tax Percentage must be a valid positive number."):n.push("Tax Percentage is required."),s.description.trim()&&!M.test(s.description)&&n.push("Description can only contain letters, numbers, spaces, hyphens (-), and commas (,)."),n.length>0){alert(`Validation Errors:
`+n.join(`
`)),c(t=>({...t,add:!1}));return}try{let t;d!==null?(t=await p.put(`/api/user/taxes/${o[d].id}/`,s),alert(t.data.message)):(t=await p.post("/api/user/taxes/",s),alert(t.data.message)),S(),h({tax_name:"",tax_percentage:"",description:""}),f(null),u(!1)}catch(t){if(console.error("Error adding/updating tax:",t),t.response&&t.response.data&&t.response.data.error){const V=Object.values(t.response.data.error).flat().join(`
`);alert(`Backend Error:
${V}`)}else alert("An unexpected error occurred. Please try again.")}finally{c(t=>({...t,add:!1}))}},z=a=>{h(o[a]),f(a),u(!0)},F=a=>{O(a),g(!0)},U=async()=>{try{await p.delete(`/api/user/taxes/${o[m].id}`);const a=o.filter((n,i)=>i!==m);y(a),console.log("Deleted tax at index",m),ae%$%$,g(!1)}catch(a){console.error("Error deleting tax",a)}},v=()=>{g(!1)},Z=()=>{const a=new oe;a.text("Tax List Report",14,15),a.autoTable({startY:25,head:[["#","Tax Name","Tax Percentage","Description"]],body:(Array.isArray(o)?o:[]).map((n,i)=>[i+1,n.tax_name,n.tax_percentage+" %",n.description]),theme:"striped"}),a.save("Tax_List.pdf")};return e.jsxs(Y,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(x,{variant:"contained",color:"secondary",onClick:q,children:d!==null?"Edit Tax":"Add Tax"}),e.jsxs(A,{open:G,onClose:E,children:[e.jsx(R,{style:{backgroundColor:"#f9dff5"},children:d!==null?"Edit Tax Details":"Add Tax Details"}),e.jsx(w,{style:{backgroundColor:"#f9dff5"},children:e.jsx(N,{sx:{padding:"10px",backgroundColor:"#f9dff5"},elevation:0,children:e.jsxs("form",{children:[e.jsxs(H,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(J,{children:"Tax Name"}),e.jsxs(Q,{value:s.tax_name,name:"tax_name",onChange:j,label:"Tax Name",inputRef:W,onKeyDown:a=>k(a,b),children:[e.jsx(T,{value:"CGST",children:"CGST"}),e.jsx(T,{value:"SGST",children:"SGST"}),e.jsx(T,{value:"IGST",children:"IGST"})]})]}),e.jsx(P,{fullWidth:!0,label:"Tax Percentage",name:"tax_percentage",value:s.tax_percentage,onChange:j,margin:"normal",required:!0,inputRef:b,onKeyDown:a=>k(a,_)}),e.jsx(P,{fullWidth:!0,multiline:!0,rows:4,label:"Description",name:"description",value:s.description,onChange:j,margin:"normal",inputRef:_})]})})}),e.jsxs(I,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(x,{onClick:E,color:"error",children:"Cancel"}),e.jsx(x,{onClick:K,color:"secondary",disabled:D.add,children:D.add?e.jsx(X,{size:24}):d!==null?"Update":"Add"})]})]}),e.jsx(ee,{component:N,sx:{marginTop:3},children:e.jsxs(ne,{children:[e.jsx(te,{children:e.jsxs(L,{children:[e.jsx(l,{children:"Tax Name"}),e.jsx(l,{children:"Tax Percentage"}),e.jsx(l,{children:"Description"}),e.jsx(l,{children:"Actions"}),e.jsx(l,{children:e.jsx(C,{color:"primary",onClick:Z,children:e.jsx(ie,{})})})]})}),e.jsx(se,{children:(Array.isArray(o)?o:[]).map((a,n)=>e.jsxs(L,{children:[e.jsx(l,{children:a.tax_name}),e.jsx(l,{children:a.tax_percentage}),e.jsx(l,{children:a.description}),e.jsxs(l,{children:[e.jsx(C,{color:"secondary",onClick:()=>z(n),children:e.jsx(re,{})}),e.jsx(C,{color:"error",onClick:()=>F(n),children:e.jsx(le,{})})]})]},n))})]})}),e.jsxs(A,{open:B,onClose:v,children:[e.jsx(R,{children:"Confirm Delete"}),e.jsx(w,{children:"Are you sure you want to delete this tax entry?"}),e.jsxs(I,{children:[e.jsx(x,{onClick:v,color:"secondary",children:"Cancel"}),e.jsx(x,{onClick:U,color:"error",children:"Confirm"})]})]})]})}export{ue as default};
